{% extends 'base.html.twig' %}

{% block title %}{{ restaurant.name }}{% endblock %}

{% block main %}
    <img src="{{ restaurant.image }}" class="rounded float-right" alt="Logo de {{ restaurant.name }}">
    {# En raison de la BD généré avec faker actuel, cette image ne fonctionnera pas et renverra le contenu alternatif #}
    <span class="description">{{ restaurant.description }}</span>
    <div class="adress"><span>{{ restaurant.address }}, {{ restaurant.postalCode }} {{ restaurant.city }}</span></div>
    {# Ici, il faudrait un bouton pour accéder au pannel de gestion si l'utilisateur est connecté et propriétaire du
    restaurant. Pour cela, il faut que la connexion ai été géré.#}
    <nav class="action-restaurant">
        <a href="reservation.html.twig">Réserver une table</a>
        {# <a href="commander.html.twig">Commander</a>  A priori, inutile si on part sur le choix expliqué ci-dessous#}
    </nav>
    <nav class="filtres-dish">
        <a href="#" data-category="B" class="active">Les boissons</a>
        <a href="#" data-category="E">Les entrées</a>
        <a href="#" data-category="P">Les plats</a>
        <a href="#" data-category="D">Les desserts</a>
    </nav>
    <div id="liste-plats">
        {# Les plats pourrait avoir un bouton, pour être ajouté a un panier afin de commander directement depuis
        cette page. Il faut ajouter un bouton cliquable sur les plats, et un bouton panier en haut de page qui référence
        les produits sélectionner si possible. Si possible pouvoir gérer la quantitée voulue, et un bouton commander
        qui enverra vers les formulaires nécéssaire pour la suite.#}
        {% for dish in restaurant.dishes %}
            <div class="plat" data-category="{{ dish.category }}">
                {{ dish.name }}
            </div>
        {% endfor %}
    </div>
    <script>
        const filtres = document.querySelectorAll('.filtres-dish a');
        const plats = document.querySelectorAll('.plat');

        function filtrerPlats(category) {
            //On retire les marqueurs active pour retirer les plats que l'on ne veut plus afficher
            plats.forEach(plat => {
                plat.classList.remove('active');
            });

            //On ajoute les marqueurs active pour les plats correspondant a la category voulue
            const platAfficher = document.querySelectorAll(`.plat[data-category*="${category}"]`);
            platAfficher.forEach(plat => {
                plat.classList.add('active');
            })
        }

        //On ajoute un event en cas de clic sur les boutons des catégories
        filtres.forEach(link => {
            link.addEventListener('click', function(event) {
                event.preventDefault();
                document.querySelector('.filtres-dish a.active').classList.remove('active');
                this.classList.add('active');
                //On récupère la category voulue
                const category = this.getAttribute('data-category');
                //On filtre les plats pour afficher ceux correspondant à la category voulue
                filtrerPlats(category);
            });
        });
        //On a défini la catégorie par défaut à afficher
        const DefaultCategory = document.querySelector('.filtres-dish a.active').getAttribute('data-category');
        //On filtre pour afficher les plats de la category par défaut
        filtrerPlats(DefaultCategory);
    </script>
{% endblock %}
